# Reproducible Research: Peer Assessment 1
Prepared by Amperio; last version created `r date()`

```{r options_setting, echo=TRUE, results='asis'}
```

## Loading and preprocessing the data
_**Note**: it is assumed that the data has been obtained in its 'original' form, as a compressed file named 'activity.zip' that contains a file named 'activity.csv' with the actual data. The format of this data file is the one presented in the Assignment introduction._

The steps for loading and processing the data are the following:

1. Read the data from the zipped file (using the 'unz' function within the 'read.csv'), with comma as a separator and using the first row for the filed names:

   ```{r}
   data <- read.csv(unz("activity.zip", "activity.csv"), header = TRUE, sep = ",")
   ```

2. Show some records at the start and the end of the data to make sure that the data has been read correctly:

   ```{r}
   head(data)
   tail(data)
   ```

3. As it will be useful later in the analysis, we calculate the average number of steps by 5-minutes intervals across all the days, and store it as a separate column in the data frame:
   ```{r}
   data.steps_by_interval <- split(data$steps, data$interval)
   data.avg_steps_by_interval <- as.integer(lapply(data.steps_by_interval, mean, na.rm=TRUE))
   data <- cbind(data, data.avg_steps_by_interval)
   colnames(data)[4] <- "avg_steps_in_interval"
   ```

4. It will also be useful to identify each date as a 'weekday' or 'weekend'; we therefore transform the 'date' variable into a separate one indicating the weekday number (1 is Monday, 2 is Tuesday, etc.):
   ```{r}
   data.dates_as_numbers <- strftime(as.Date(data$date), format = "%u")
   data <- cbind(data, data.dates_as_numbers)
   colnames(data)[5] <- "weekday_number"
   ```

5. The final data frame is therefore:
   ```{r}
   head(data)
   tail(data)
   ```

## What is mean total number of steps taken per day?

1. We create a summary data frame with the total number of steps for each day:
   ```{r}
   data.summary <- as.data.frame(unique(data$date))
   colnames(data.summary)[1] <- "date"
   data.steps_by_day <- split(data$steps, data$date)
   data.summary <- cbind(data.summary, as.integer(lapply(data.steps_by_day, sum, na.rm = TRUE)))
   colnames(data.summary)[2] <- "total_steps"
   head(data.summary)
   ```

2. With this, it is easy to present a histogram of the number of steps per day:
   ```{r}
   hist(data.summary$total_steps, breaks = 10, col = "green", main = "Frequency of days by total number of steps", xlab = "Total number of steps per day", ylab = "Number of days")
   ```

3. And we can also calculate the mean and median total number of steps for all the days:
   ```{r}
   mean(data.summary$total_steps)
   median(data.summary$total_steps)
   ```

## What is the average daily activity pattern?

1. Here it is useful the precalculated data by 5-minutes interval to show the time series:
   ```{r}
   plot(unique(data$interval), data.avg_steps_by_interval, type = "l", col = "blue", main = "Average number of steps taken by 5-minutes interval", xlab = "Interval", ylab = "Steps")
   ```

2. As for the calculation of the 5-minute interval with the maximum number of steps on average, the maximum value of steps taken is...
   ```{r}
   max(data.avg_steps_by_interval)
   ```

   ... which is obtained in the interval number ...
   ```{r}
   which.max(data.avg_steps_by_interval)
   ```

   ... which corresponds to interval ...
   ```{r}
   unique(data$interval)[which.max(data.avg_steps_by_interval)]
   ```

   ... that is, in time format:
   ```{r}
   max.interval.name <- as.character(unique(data$interval)[which.max(data.avg_steps_by_interval)])
   max.interval.minutes <- substr(max.interval.name, nchar(max.interval.name)-1, nchar(max.interval.name))
   max.interval.hour <- substr(max.interval.name, 1, nchar(max.interval.name)-nchar(max.interval.minutes))
   cat("The interval with the average maximum number of steps (", max(data.avg_steps_by_interval), " steps) occurred at ", max.interval.hour, " hours and ", max.interval.minutes, " minutes")
   ```

## Imputing missing values

1. The number of missing values for the number of steps in the original data is:
   ```{r}
   sum(is.na(data$steps))
   ```

2. To fill in these missing values, we use the average for each 5-minutes interval across all the days; this was precalculated when the data was read (see above) and stored in the 'avg_steps_in_interval' column:
   ```{r}
   head(data)
   ```

3. Now we substitute the missing values using these averages:
   ```{r}
   data <- cbind(data, data$steps)
   colnames(data)[6] <- "steps_adj"
   data$steps_adj[is.na(data$steps)] <- data$avg_steps_in_interval
   ```

3. Thus we can create a new histogram for the total number of steps taken by day:
   ```{r}
   data.steps_by_day_adj <- split(data$steps_adj, data$date)
   data.summary <- cbind(data.summary, as.integer(lapply(data.steps_by_day_adj, sum, na.rm = TRUE)))
   colnames(data.summary)[3] <- "total_steps_adj"
   hist(data.summary$total_steps_adj, breaks = 10, col = "orange", main = "Frequency of days by total number of steps (adjusted)", xlab = "Total number of steps per day (adjusted)", ylab = "Number of days")
   ```

4. And compare the two histograms:
   ```{r}
   library(ggplot2)
   p <- ggplot(data.summary, aes(x = total_steps)) + geom_histogram(fill = "green", alpha = 0.4) + geom_histogram (aes(x = total_steps_adj), fill = "orange", alpha = 0.4) + labs(title = "Frequency of days by total number of steps") + xlab("Total number of steps per day") + ylab("Number of days")
   suppressMessages(print(p))
   ```

5. We can now calculate the new mean and median total number of steps for all the days:
   ```{r}
   mean(data.summary$total_steps_adj)
   median(data.summary$total_steps_adj)
   ```

6. We observe that these values are higher than the ones calculated above; and the same occurs in the histogram, with one of the bars 'receiving' the days wich previously had a small number of steps while now they compute a much higher value (and always the same given that we have applied the 5-minutes average values to fill in the missing values)

## Are there differences in activity patterns between weekdays and weekends?
